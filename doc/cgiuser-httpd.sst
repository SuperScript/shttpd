<html>
<head>\title{shttpd}</head>
<body>
\crumbs
\h1{The \tt{cgiuser-httpd} program}

\h2{Interface}
<pre>
  cgiuser-httpd \it{prog}
</pre>
where \ti{prog} is one or more arguments specifying a program to run
for each valid request.

\tt{cgiuser-httpd} behaves like \a{cgi-httpd.html}{\tt{cgi-httpd}} with two
exceptions: \tt{cgiuser-httpd} does not invoke \tt{chroot}, and it sets the
execution path to \tt{/bin:/usr/bin} before invoking \ti{prog}.

\tt{cgiuser-httpd} reads an HTTP request message from standard input,
and treats the URI path as the name of a CGI script.  The script is
expected to print its reply to standard output.

Before reading any input, \tt{cgiuser-httpd} changes the working directory to
that named in the \tt{$ROOT} environment variable, and then sets its group id
and user id to the numeric values given in the environment variables \tt{$GID}
and \tt{$UID}, typically set with
\a{http://cr.yp.to/daemontools/envdir.html}{\tt{envdir}}.  Before executing
\ti{prog}, \tt{cgiuser-httpd} sets the execution path to \tt{/bin:/usr/bin}.
If it cannot carry out these operations, \tt{cgiuser-httpd} complains to
standard output and exits 111.

If it encounters an error in processing a request, \tt{cgiuser-httpd}
exits 21.  Otherwise, it returns the exit code of \ti{prog}.

For a request specifying the hostname \ti{H}, \tt{cgiuser-httpd}
changes its working directory to \tt{./host/\ti{H}} after replacing
\tt{/.}  with \tt{/:} and \tt{//} with \tt{/} in
\tt{./host/\ti{H}}.  When a valid request lacks a host name,
\tt{cgiuser-httpd} uses \tt{0} as the host name.  After changing the
working directory, \tt{cgiuser-httpd} sets the cgi environment variables
and executes \ti{prog}.

\tt{cgiuser-httpd} accepts HTTP/0.9, HTTP/1.0, and HTTP/1.1 requests.  It
supports HEAD, GET, and POST, and rejects all other methods.

\tt{cgiuser-httpd} manipulates the following environment variables:

\tt{$AUTH_TYPE} is unset.

\tt{$CONTENT_LENGTH} is the content length of the request, if
applicable, or unset.

\tt{$CONTENT_TYPE} is the content type of the request, if
applicable, or unset.

\tt{$GATEWAY_INTERFACE} is the string \tt{CGI/1.1}

\tt{$PATH_INFO} is the path portion of the request URI, after URL
decoding.

\tt{$PATH_TRANSLATED} is unset.

\tt{$QUERY_STRING} is the query string portion of the request URI.

\tt{$REMOTE_ADDR} is set to the value of the environment variable \tt{$TCPREMOTEIP}.

\tt{$REMOTE_HOST} is set to the value of the environment variable \tt{$TCPREMOTEHOST}.

\tt{$REMOTE_USER} is set to the value of the environment variable \tt{$TCPREMOTEINFO}.

\tt{$REQUEST_METHOD} is set to the method of the request URI.

\tt{$SCRIPT_NAME} is the empty string.

\tt{$SERVER_NAME} is the name of the host given in the request, if
applicable, and 0 otherwise.

\tt{$SERVER_PORT} is the value of the environment variable \tt{$TCPLOCALPORT}.

\tt{$SERVER_PROTOCOL} is one of the strings \tt{HTTP/0.9},
\tt{HTTP/1.0}, or \tt{HTTP/1.1}.

\tt{$SERVER_SOFTWARE} is the string \tt{cgiuser-httpd}.

</body></html>
