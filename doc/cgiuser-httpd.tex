\documentclass{book}
\usepackage{sstdef}
\title{shttpd}
\begin{document}
\section{The \cmd{cgiuser-httpd} program}

\subsection{Interface}
\begin{code}
  cgiuser-httpd \var{prog}
\end{code}
where \cvar{prog} is one or more arguments specifying a program to run
for each valid request.

\cmd{cgiuser-httpd} behaves like \href{\cmd{cgi-httpd}}{cgi-httpd.html} with two
exceptions: \cmd{cgiuser-httpd} does not invoke \cmd{chroot}, and it sets the
execution path to \cmd{/bin:/usr/bin} before invoking \cvar{prog}.

\cmd{cgiuser-httpd} reads an HTTP request message from standard input,
and treats the URI path as the name of a CGI script.  The script is
expected to print its reply to standard output.

Before reading any input, \cmd{cgiuser-httpd} changes the working directory to
that named in the \cmd{\$ROOT} environment variable, and then sets its group id
and user id to the numeric values given in the environment variables \cmd{\$GID}
and \cmd{\$UID}, typically set with
\href{\cmd{envdir}}{http://cr.yp.to/daemontools/envdir.html}.  Before executing
\cvar{prog}, \cmd{cgiuser-httpd} sets the execution path to \cmd{/bin:/usr/bin}.
If it cannot carry out these operations, \cmd{cgiuser-httpd} complains to
standard output and exits 111.

If it encounters an error in processing a request, \cmd{cgiuser-httpd}
exits 21.  Otherwise, it returns the exit code of \cvar{prog}.

For a request specifying the hostname \cvar{H}, \cmd{cgiuser-httpd}
changes its working directory to \cmd{./host/\cvar{H}} after replacing
\cmd{/.}  with \cmd{/:} and \cmd{//} with \cmd{/} in
\cmd{./host/\cvar{H}}.  When a valid request lacks a host name,
\cmd{cgiuser-httpd} uses \cmd{0} as the host name.  After changing the
working directory, \cmd{cgiuser-httpd} sets the cgi environment variables
and executes \cvar{prog}.

\cmd{cgiuser-httpd} accepts HTTP/0.9, HTTP/1.0, and HTTP/1.1 requests.  It
supports HEAD, GET, and POST, and rejects all other methods.

\cmd{cgiuser-httpd} manipulates the following environment variables:

\cmd{\$AUTH_TYPE} is unset.

\cmd{\$CONTENT_LENGTH} is the content length of the request, if
applicable, or unset.

\cmd{\$CONTENT_TYPE} is the content type of the request, if
applicable, or unset.

\cmd{\$GATEWAY_INTERFACE} is the string \cmd{CGI/1.1}

\cmd{\$PATH_INFO} is the path portion of the request URI, after URL
decoding.

\cmd{\$PATH_TRANSLATED} is unset.

\cmd{\$QUERY_STRING} is the query string portion of the request URI.

\cmd{\$REMOTE_ADDR} is set to the value of the environment variable \cmd{\$TCPREMOTEIP}.

\cmd{\$REMOTE_HOST} is set to the value of the environment variable \cmd{\$TCPREMOTEHOST}.

\cmd{\$REMOTE_USER} is set to the value of the environment variable \cmd{\$TCPREMOTEINFO}.

\cmd{\$REQUEST_METHOD} is set to the method of the request URI.

\cmd{\$SCRIPT_NAME} is the empty string.

\cmd{\$SERVER_NAME} is the name of the host given in the request, if
applicable, and 0 otherwise.

\cmd{\$SERVER_PORT} is the value of the environment variable \cmd{\$TCPLOCALPORT}.

\cmd{\$SERVER_PROTOCOL} is one of the strings \cmd{HTTP/0.9},
\cmd{HTTP/1.0}, or \cmd{HTTP/1.1}.

\cmd{\$SERVER_SOFTWARE} is the string \cmd{cgiuser-httpd}.

\end{document}
